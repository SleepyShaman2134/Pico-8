pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
 x = 3
 y = 2
 t = 0 --tick
 f = 0 --frame
 s = 6 --step
 hero = 020
 initiate_spr_animations()
 init_counters()
 printh("initiated")
 scanner = 0
 x_scanner = 0
 y_scanner = 0
 
    
end

function _draw()
	cls()
	map()
	--print(map_tile_i)
	spr(hero, x*8, y*8)
	animate_map()		
end

--we scan the tiles based on 
--their drawing id
function _update()
	t = (t+1)%s
	
	scan_map()
	animate_frame()
	move()
 camera(0, 0)
 printh("updating")
end


-->8
function move()
	local speed = 1
	if btnp(⬇️)then
		y += speed
	elseif  btnp(⬆️) then
		y -= speed
	elseif  btnp(⬅️) then
		x -= speed
	elseif  btnp(➡️) then
		x += speed
	end
end


function scan_map()
	for i = 0 + level_index_i, 15 + level_index_i do
  for j = 0 + level_index_j, 15 + level_index_j do
      map_tile[i][j] = mget(i, j) 
		end
	end
end
-->8
function animate_frame()
	animate_frame_hero()
 animate_frame_sand()
--	aniamte_spike()
--	animate_worm_enemy()
end

function animate_frame_hero()
	
end

function animate_frame_sand()
	if t == 0 then
		f_sand = (f_sand+1) % #spr_sands
	end
end

function animate_map()
	for i=0 + level_index_i, 15 + level_index_i do
		for j = 0 + level_index_j, 15 + level_index_j do
			local tile = mget(i, j)
			--map_tile[i][j]
			if tile  == 1 or tile == 2 then
			--	mset(i, j,	0)
				mset(i, j, spr_sands[f_sand+1])
			end
		end
	end
end


-->8
function initiate_spr_animations()
	spr_hero_sideway = {019, 020}
	spr_hero_front = {020}
	spr_hero_back = {021}
	spr_lever = {003}
	spr_door_closed = {005}
	spr_ddor_opened = {006, 007}
	spr_spikes = {009, 010}
	spr_sands = {1, 2}
	spr_enemy_idle = {025}
	spr_enemy_walk = {024}
end

function init_counters()
	map_index = 0
	map_tile_i = {}
		map_tile_j = {}
		map_tile = {}
	for i = 0, 15 do
		map_tile_i[i] = 0
		map_tile_j[i] = 0
		map_tile[i] = {}
		for j = 0, 15 do
			map_tile[i][j] = 0
		end
	end	
	level_index_i = 0
	level_index_j = 0
	f_sand = 0
end
__gfx__
00000000999999499999999499999999999999999999999999999999999999999999999999999999999999994004040499999999000000004444444400000000
00000000949999999949999999999999999999999900009999000099990000999999999996996999979979994040040499966999000000004444444400000000
00700700999949999999999999997799997799999004400990077009900660099999999996996969969969790040400499666699000000004444444400000000
00077000999999999499999499997999999799999044440990777709906666099999999996996969969969690400404099666699000000004444444400000000
00077000494999949999999999900999999009999044440990777709906666099999999999999969999999690404004096666669000000004444444400000000
00700700999994999999999999777799997777999044400990777709906666099999999999699699997997994004040096666669000000004444444400000000
00000000999994999949994999799799997997999044440990777709906666099999999999699699996996994040040496666669000000004444444400000000
00000000999499994999999977799777777997779044440990777709906666099999999999699699996996994040400466666666000000004444444400000000
9999999989966999999cc999999cc999999cc999999cc99900000000000000009999999999999999000000000000000000000000000000000000000000000000
9999999888966999999aa999999aa999999aa999999aa999000000000000000099ee49999999ee49000000000000000000000000000000000000000000000000
999998888888699999222999922229999992299999922999000000000000000099e449999999e449000000000000000000000000000000000000000000000000
99998888888889999228899992988999999889999992299900000000000000009944449999994499000000000000000000000000000000000000000000000000
99998888888889999998899999988999992889999922899900000000000000009994449999994499000000000000000000000000000000000000000000000000
99988888888888999991199999911999999119999991199900000000000000009999444999994499000000000000000000000000000000000000000000000000
99988888888888999991199999911999999119999991199900000000000000009999944999944499000000000000000000000000000000000000000000000000
99944444444444999991199999911999999119999991199900000000000000009999944499444449000000000000000000000000000000000000000000000000
99940000044444990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99940606044444990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99940606044400990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99940000044000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99944444444055990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99944444444055990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99944444444055990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99944444444055990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b101108080c01010101010c050c010b0b02020102010b0b0b0c01020102020b0b0c0c010c0c0c020c0c0c0c0c0c0c0b0b0c0c0c0c0c0c0c080808080808080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b202108080c01010101010c080c0c0b0b02010201020b0b0b0c0c010102010b0b0c0c0c0c0c0c0c0c0c0808080c0c0b0b0808080908090c0c0c0c0c0808080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0c0c08080c0c0c0c0c0c0c08080c0b0b01020c0c0c0b050b080c0c0201020b0b05080808080808080808090808050b0b080808090808080908090c0c0c080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b020c08080808080808080808080c0b0b0c0c0c080808080808080c0c0c0c0b0b0c0c0c0c0c0c0c0c0c0c0c0c0c0c0b0b0508080808090809080808080c0c0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b020c0808080808080c080808080c0b0b05080808080808080808080808050b0b0c0c0c02020c0c0c010c0c0c020c0b0b080808090809080808090c0c0c080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b020c0c0c0c0c0c080c0c0c0c0c0c0b0b0c0c0c0808080808080c0c0c080c0b0b02020202020c010c0c0c0c0c0c0c0b0b080808090809080c0c0c080808080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0202020202020c0808080808030c0b0b0c0c0c0c0c080808080c0c0c0c0c0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0c0c0c0c0c0c0c0c0808080808080b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b02010c0c0c0c08080c0c0c0c0c0c0b000000000000000000000000000000000b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b0102020c0c0c08080c0c010201010b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b020101020c0c08080c0c010202020b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b020202010c0c08080c0c020102010b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b020201020c0c08080c0c020202020b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b020102020c0c08080c0c020101010b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b010202020c0c08080c0c020202010b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
